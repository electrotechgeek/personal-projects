
spi.o:     file format elf32-avr

Sections:
Idx Name          Size      VMA       LMA       File off  Algn
  0 .text         000000b8  00000000  00000000  00000034  2**0
                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE
  1 .data         00000000  00000000  00000000  000000ec  2**0
                  CONTENTS, ALLOC, LOAD, DATA
  2 .bss          00000005  00000000  00000000  000000ec  2**0
                  ALLOC
  3 .debug_abbrev 000000c9  00000000  00000000  000000ec  2**0
                  CONTENTS, READONLY, DEBUGGING
  4 .debug_info   000001d0  00000000  00000000  000001b5  2**0
                  CONTENTS, RELOC, READONLY, DEBUGGING
  5 .debug_line   0000017e  00000000  00000000  00000385  2**0
                  CONTENTS, RELOC, READONLY, DEBUGGING
  6 .debug_frame  00000040  00000000  00000000  00000504  2**2
                  CONTENTS, RELOC, READONLY, DEBUGGING
  7 .debug_loc    0000001f  00000000  00000000  00000544  2**0
                  CONTENTS, READONLY, DEBUGGING
  8 .debug_pubnames 0000009c  00000000  00000000  00000563  2**0
                  CONTENTS, RELOC, READONLY, DEBUGGING
  9 .debug_pubtypes 00000026  00000000  00000000  000005ff  2**0
                  CONTENTS, RELOC, READONLY, DEBUGGING
 10 .debug_aranges 00000020  00000000  00000000  00000625  2**0
                  CONTENTS, RELOC, READONLY, DEBUGGING
 11 .debug_str    0000013c  00000000  00000000  00000645  2**0
                  CONTENTS, READONLY, DEBUGGING

Disassembly of section .text:

00000000 <__vector_12>:
u08 spiEvent = 0;


//ISR(SIG_SPI)
ISR(SPI_STC_vect)
{
   0:	1f 92       	push	r1
   2:	0f 92       	push	r0
   4:	0f b6       	in	r0, 0x3f	; 63
   6:	0f 92       	push	r0
   8:	11 24       	eor	r1, r1
   a:	8f 93       	push	r24
   c:	9f 93       	push	r25
   e:	ef 93       	push	r30
  10:	ff 93       	push	r31
    mosiBuffer[mosiHead++] = SPDR;
  12:	80 91 00 00 	lds	r24, 0x0000
  16:	9e b5       	in	r25, 0x2e	; 46
  18:	e8 2f       	mov	r30, r24
  1a:	f0 e0       	ldi	r31, 0x00	; 0
  1c:	e0 50       	subi	r30, 0x00	; 0
  1e:	f0 40       	sbci	r31, 0x00	; 0
  20:	90 83       	st	Z, r25
  22:	8f 5f       	subi	r24, 0xFF	; 255
    mosiHead &= (MOSIBUFFERSIZE - 1);
  24:	87 70       	andi	r24, 0x07	; 7
  26:	80 93 00 00 	sts	0x0000, r24
    spiEvent = 1;
  2a:	81 e0       	ldi	r24, 0x01	; 1
  2c:	80 93 00 00 	sts	0x0000, r24
    if (misoHead != misoTail)
  30:	80 91 00 00 	lds	r24, 0x0000
  34:	90 91 00 00 	lds	r25, 0x0000
  38:	98 17       	cp	r25, r24
  3a:	01 f0       	breq	.+0      	; 0x3c <__vector_12+0x3c>
    {
        SPDR = misoBuffer[misoTail++];
  3c:	e8 2f       	mov	r30, r24
  3e:	f0 e0       	ldi	r31, 0x00	; 0
  40:	e0 50       	subi	r30, 0x00	; 0
  42:	f0 40       	sbci	r31, 0x00	; 0
  44:	90 81       	ld	r25, Z
  46:	9e bd       	out	0x2e, r25	; 46
  48:	8f 5f       	subi	r24, 0xFF	; 255
        misoTail &= (MISOBUFFERSIZE - 1);
  4a:	87 70       	andi	r24, 0x07	; 7
  4c:	80 93 00 00 	sts	0x0000, r24
  50:	00 c0       	rjmp	.+0      	; 0x52 <__vector_12+0x52>
    }
    else
    {
        SPDR = 0x00;
  52:	1e bc       	out	0x2e, r1	; 46
    }
}
  54:	ff 91       	pop	r31
  56:	ef 91       	pop	r30
  58:	9f 91       	pop	r25
  5a:	8f 91       	pop	r24
  5c:	0f 90       	pop	r0
  5e:	0f be       	out	0x3f, r0	; 63
  60:	0f 90       	pop	r0
  62:	1f 90       	pop	r1
  64:	18 95       	reti

00000066 <spi_init>:

void spi_init(void)
{
  66:	df 93       	push	r29
  68:	cf 93       	push	r28
  6a:	0f 92       	push	r0
  6c:	cd b7       	in	r28, 0x3d	; 61
  6e:	de b7       	in	r29, 0x3e	; 62
    volatile char IOReg;
    DDRB |= _BV(PB3); 		/* Enable MISO for output */
  70:	23 9a       	sbi	0x04, 3	; 4
    PRR &= ~_BV(PRSPI);		/* Turn on the SPI module */
  72:	e4 e6       	ldi	r30, 0x64	; 100
  74:	f0 e0       	ldi	r31, 0x00	; 0
  76:	80 81       	ld	r24, Z
  78:	8b 7f       	andi	r24, 0xFB	; 251
  7a:	80 83       	st	Z, r24
    // Clear out any odd crap
    SPDR = 0;
  7c:	1e bc       	out	0x2e, r1	; 46
    IOReg = SPDR;
  7e:	8e b5       	in	r24, 0x2e	; 46
  80:	89 83       	std	Y+1, r24	; 0x01
    IOReg = SPDR;
  82:	8e b5       	in	r24, 0x2e	; 46
  84:	89 83       	std	Y+1, r24	; 0x01

    IOReg = SPSR;
  86:	8d b5       	in	r24, 0x2d	; 45
  88:	89 83       	std	Y+1, r24	; 0x01
    IOReg = SPDR;
  8a:	8e b5       	in	r24, 0x2e	; 46
  8c:	89 83       	std	Y+1, r24	; 0x01
    SPCR = _BV(SPE) | _BV(SPIE);		/* Enable SPI interrupts, MSB first */
  8e:	80 ec       	ldi	r24, 0xC0	; 192
  90:	8c bd       	out	0x2c, r24	; 44
}
  92:	0f 90       	pop	r0
  94:	cf 91       	pop	r28
  96:	df 91       	pop	r29
  98:	08 95       	ret

0000009a <miso_push>:

void miso_push(u08 data)
{
    cli();
  9a:	f8 94       	cli
    misoBuffer[misoHead++] = data;
  9c:	90 91 00 00 	lds	r25, 0x0000
  a0:	e0 e0       	ldi	r30, 0x00	; 0
  a2:	f0 e0       	ldi	r31, 0x00	; 0
  a4:	e9 0f       	add	r30, r25
  a6:	f1 1d       	adc	r31, r1
  a8:	80 83       	st	Z, r24
  aa:	89 2f       	mov	r24, r25
  ac:	8f 5f       	subi	r24, 0xFF	; 255
    misoHead &= (MISOBUFFERSIZE - 1);
  ae:	87 70       	andi	r24, 0x07	; 7
  b0:	80 93 00 00 	sts	0x0000, r24
    sei();
  b4:	78 94       	sei
}
  b6:	08 95       	ret
